<link href="../polymer/polymer.html" rel="import">

<polymer-element name="paper-input" attributes="autofocus value label floating pressed" tabindex="0" on-pointerdown="{{pointerdownAction}}" on-pointerup="{{pointerupAction}}" on-blur="{{blurAction}}" on-focus="{{focusAction}}">
  <template>
    <style>
      :host {
        display: inline-block;
        outline: none;
        text-align: start;
        color: #ccc;
      }
      :host:hover {
        cursor: text;
      }
      #container {
        position: relative;
      }
      input {
        font: inherit;
        color: #000;
        padding: 0.5em 0;
        background-color: transparent;
        border: none;
        outline: none;
        width: 100%;
      }
      #inputClone {
        position: absolute;
        left: -99999px;
      }
      .focusedColor {
        color: #4059a9;
        background: #4059a9;
      }
      #floatingLabel {
        font-size: 0.75em;
        background: transparent;
        white-space: nowrap;
      }
      #floatingLabel.hidden {
        visibility: hidden;
      }
      #floatingLabel.focused {
        visibility: visible;
      }
      #label {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        padding: 0.5em 0;
        background: transparent;
        white-space: nowrap;
        -webkit-transform-origin: 0% 0%;
      }
      #label.hidden {
        display: none;
      }
      #label.animating {
        transition: -webkit-transform 0.3s cubic-bezier(0.2, 0, 0.03, 1);
        -webkit-transform: scale(0.75) translateY(-70%);
      }
      #underline {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        height: 2px;
        background: #ccc;
      }
      #underlineHighlight {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        height: 2px;
        -webkit-transform: scale(0,2);
      }
      #underlineHighlight.pressed {
        -webkit-transform: scale(0.1,2);
        transition: -webkit-transform 0.1s cubic-bezier(0.2, 0, 0.03, 1);
      }
      #underlineHighlight.animating {
        transition: -webkit-transform 0.3s cubic-bezier(0.2, 0, 0.03, 1);
      }
      #underlineHighlight.focused {
        -webkit-transform: scale(1);
      }
      #caret {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        opacity: 0;
        -webkit-transform-origin-x: 0%;
        -webkit-transform: scaleX(1) translateX(10%);
      }
      #caret.animating {
        transition: -webkit-transform 0.15s ease-out, opacity 0.15s ease-out;
      }
      #caret.focused {
        opacity: 0.75;
        -webkit-transform: scaleX(0) translateX(0);
      }
      #caretInner {
        position: absolute;
        top: 0.6em;
        left: 0;
        bottom: 0.6em;
        width: 25%;
      }
    </style>
    <template if="{{floating}}">
      <div id="floatingLabel" class="focusedColor hidden">{{label}}</div>
    </template>
    <div id="container" on-transitionend="{{transitionEndAction}}" on-webkitTransitionEnd="{{transitionEndAction}}">
      <span id="inputClone">{{value}}</span>
      <div id="label">{{label}}</div>
      <input id="input" value="{{value}}">
      <div id="underline"></div>
      <div id="underlineHighlight" class="focusedColor"></div>
      <div id="caret">
        <div id="focusedColor caretInner"></div>
      </div>
    </div>
  </template>
  <script>
    Polymer('paper-input', {
      autofocus: false,
      floating: false,
      focused: false,
      pressed: false,
      label: null,
      value: null,
      ready: function() {
        if (this.value) {
          this.$.floatingLabel.classList.remove('hidden');
        }
      },
      focusAction: function(e) {
        if (!this.pressed) {
          if (this.floating) {
            this.$.floatingLabel.classList.remove('hidden');
            this.$.floatingLabel.classList.add('focused');
          }
          this.$.label.classList.add('hidden');
          this.$.underlineHighlight.classList.add('focused');
          this.$.caret.classList.add('focused');
          this.$.input.focus();
        }
        this.focused = true;
      },
      blurAction: function() {
        this.$.underlineHighlight.classList.remove('focused');
        this.$.caret.classList.remove('focused');
        if (this.floating) {
          this.$.floatingLabel.classList.remove('focused');
          if (!this.value) {
            this.$.floatingLabel.classList.add('hidden');
          }
        }
        if (!this.value) {
          this.$.label.classList.remove('hidden');
        }
        this.focused = false;
      },
      pointerdownAction: function(e) {
        if (this.focused) {
          return;
        }
        this.pressed = true;
        var rect = this.$.underline.getBoundingClientRect();
        var right = e.x - rect.left;
        this.$.underlineHighlight.style.webkitTransformOriginX = right + 'px';
        this.$.underlineHighlight.classList.remove('focused');
        this.underlineAsync = this.async(function() {
          this.$.underlineHighlight.classList.add('pressed');
        }, null, 200);
        var width = this.$.inputClone.getBoundingClientRect().width;
        if (width < right) {
          this.$.caret.style.left = width + 'px';
          this.$.caret.classList.remove('focused');
        }
      },
      pointerupAction: function() {
        if (!this.pressed) {
          return;
        }
        if (this.underlineAsync) {
          clearTimeout(this.underlineAsync);
          this.underlineAsync = null;
        }
        this.pressed = false;
        this.$.underlineHighlight.classList.remove('pressed');
        this.$.underlineHighlight.classList.add('animating');
        this.async(function() {
          this.$.underlineHighlight.classList.add('focused');
        });
        this.$.caret.classList.add('animating');
        this.async(function() {
          this.$.caret.classList.add('focused');
        }, null, 150);
        if (this.floating) {
          this.$.label.classList.add('focusedColor');
          this.$.label.classList.add('animating');
        }
      },
      transitionEndAction: function(e) {
        if (this.pressed) {
          return;
        }
        this.$.label.classList.add('hidden');
        this.$.label.classList.remove('focusedColor');
        if (this.floating) {
          this.$.label.classList.remove('animating');
          this.$.floatingLabel.classList.remove('hidden');
          this.$.floatingLabel.classList.add('focused');
        }
        this.async(function() {
          this.$.underlineHighlight.classList.remove('animating');
          this.$.caret.classList.remove('animating');
          this.$.input.focus();
        }, null, 100);
      }
    });
  </script>
</polymer-element>